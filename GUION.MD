# Workshop: Despliegue End-to-End con NEW AI Foundry
## Sistema de Gesti√≥n de Tribu de Capibaras con Multi-Agentes

---

## üìã Tabla de Contenidos

1. [Introducci√≥n](#introducci√≥n)
2. [Prerequisitos](#prerequisitos)
3. [Arquitectura de la Soluci√≥n](#arquitectura-de-la-soluci√≥n)
4. [Paso 1: Preparaci√≥n del Entorno Azure](#paso-1-preparaci√≥n-del-entorno-azure)
5. [Paso 2: Configuraci√≥n de Almacenamiento y Datos](#paso-2-configuraci√≥n-de-almacenamiento-y-datos)
6. [Paso 3: Creaci√≥n de Azure AI Search y Knowledge Base](#paso-3-creaci√≥n-de-azure-ai-search-y-knowledge-base)
7. [Paso 4: Creaci√≥n del Proyecto AI Foundry](#paso-4-creaci√≥n-del-proyecto-ai-foundry)
8. [Paso 5: Configuraci√≥n de Modelos](#paso-5-configuraci√≥n-de-modelos)
9. [Paso 6: Creaci√≥n de Knowledge Base en AI Foundry](#paso-6-creaci√≥n-de-knowledge-base-en-ai-foundry)
10. [Paso 7: Creaci√≥n de Agentes](#paso-7-creaci√≥n-de-agentes)
11. [Paso 8: Creaci√≥n del Workflow Orquestador](#paso-8-creaci√≥n-del-workflow-orquestador)
12. [Paso 9: Testing y Validaci√≥n](#paso-9-testing-y-validaci√≥n)
13. [Paso 10: Despliegue y Consumo](#paso-10-despliegue-y-consumo)
14. [Troubleshooting](#troubleshooting)
15. [Recursos Adicionales](#recursos-adicionales)

---

## Introducci√≥n

### ¬øQu√© es NEW AI Foundry?

**Azure AI Foundry** es la plataforma unificada de Microsoft para construir, desplegar y gestionar aplicaciones de IA empresariales. Combina capacidades de:

- **Azure OpenAI Service**: Modelos GPT-4, GPT-4o, etc.
- **Azure AI Search**: B√∫squeda cognitiva y vectorial (RAG)
- **Azure AI Studio**: Interfaz visual para orquestar agentes
- **Prompt Flow / Workflows**: Orquestaci√≥n de flujos de IA
- **Model Catalog**: Acceso a modelos de IA de Microsoft y open source

### ¬øQu√© construiremos?

Un **sistema multi-agente** que simula la gesti√≥n de una tribu de capibaras con:

- **1 Agente Orquestador (Secretario)**: Recibe solicitudes y las deriva al departamento correcto
- **4 Agentes Especialistas**:
  - **Intendencia**: Gesti√≥n de alimentaci√≥n y cocina
  - **Seguridad**: Vigilancia y exploraci√≥n
  - **Infraestructuras**: Construcci√≥n y mantenimiento
  - **Festejos**: Organizaci√≥n de eventos y celebraciones

- **Knowledge Base (RAG)**: Base de datos de ~200 capibaras con habilidades espec√≠ficas
- **Workflow**: Flujo que coordina la comunicaci√≥n entre agentes

### Caso de Uso

El usuario (Capibara Jefe) solicita una tarea, el Secretario analiza la petici√≥n y la deriva al Director apropiado, quien consulta la base de conocimientos para asignar capibaras con las habilidades necesarias.

**Ejemplo:**
```
Usuario: "Necesito organizar una fiesta para celebrar la cosecha"
Secretario ‚Üí [FESTEJOS]
Festejos ‚Üí Consulta KB ‚Üí Asigna capibaras con habilidades:
  - Decoraci√≥n y ambientaci√≥n (nivel 4+)
  - Organizaci√≥n de eventos (nivel 3+)
  - M√∫sica y animaci√≥n (nivel 3+)
```

---

## Prerequisitos

### Conocimientos Previos
- Conceptos b√°sicos de Azure (recursos, resource groups)
- Familiaridad con JSON
- Comprensi√≥n b√°sica de agentes de IA y RAG (Retrieval Augmented Generation)

### Requisitos T√©cnicos

#### Cuenta y Suscripci√≥n Azure
- Suscripci√≥n de Azure activa con permisos de Contributor
- Capacidad para crear recursos en Azure OpenAI (requiere solicitud de acceso)

#### Software Local
- **Azure CLI** instalado: https://aka.ms/azcli
- **Python 3.10+** (para testing local opcional)
- **Visual Studio Code** (recomendado)
- Navegador web moderno (Edge, Chrome)

#### Acceso a Servicios
- Azure OpenAI Service (GPT-4 o superior habilitado)
- Azure AI Search
- Azure Storage Account

### Estimaci√≥n de Costos
- Azure OpenAI: ~$30-50 para desarrollo/testing
- Azure AI Search: Free tier disponible (suficiente para workshop)
- Storage Account: <$1

---

## Arquitectura de la Soluci√≥n

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                         USUARIO (Jefe)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                         ‚îÇ
                         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    WORKFLOW (CapibaraCouncil)                   ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê   ‚îÇ
‚îÇ  ‚îÇ  Trigger: OnConversationStart                           ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  1. Invoca Secretario (loop hasta tag)                  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  2. Eval√∫a tag [INTENDENCIA|SEGURIDAD|INFRA|FESTEJOS]  ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  3. Invoca Director correspondiente                     ‚îÇ   ‚îÇ
‚îÇ  ‚îÇ  4. EndConversation                                     ‚îÇ   ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îò
    ‚îÇ                       ‚îÇ                ‚îÇ                ‚îÇ
    ‚ñº                       ‚ñº                ‚ñº                ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇSecretario‚îÇ         ‚îÇIntendencia‚îÇ   ‚îÇSeguridad‚îÇ    ‚îÇFestejos  ‚îÇ
‚îÇValent√≠n ‚îÇ         ‚îÇ  Mateo   ‚îÇ   ‚îÇ  Luc√≠a   ‚îÇ    ‚îÇ  Sof√≠a   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                     ‚îÇ              ‚îÇ               ‚îÇ
     ‚îÇ                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                            ‚ñº               ‚îÇ
     ‚îÇ                  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
     ‚îÇ                  ‚îÇ  KNOWLEDGE BASE  ‚îÇ      ‚îÇ
     ‚îÇ                  ‚îÇ  (Azure AI Search)‚îÇ     ‚îÇ
     ‚îÇ                  ‚îÇ                  ‚îÇ      ‚îÇ
     ‚îÇ                  ‚îÇ ‚Ä¢ 200+ Capibaras ‚îÇ      ‚îÇ
     ‚îÇ                  ‚îÇ ‚Ä¢ 15 Habilidades ‚îÇ      ‚îÇ
     ‚îÇ                  ‚îÇ ‚Ä¢ Disponibilidad ‚îÇ      ‚îÇ
     ‚îÇ                  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
     ‚îÇ                            ‚ñ≤               ‚îÇ
     ‚îÇ                            ‚îÇ               ‚îÇ
     ‚îÇ                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§  BLOB STORAGE ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚îÇ  (JSON files)  ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                  ‚ñ≤
                                  ‚îÇ
                          ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
                          ‚îÇ capibara_*.json‚îÇ
                          ‚îÇ (110 archivos) ‚îÇ
                          ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Componentes Principales

| Componente | Servicio Azure | Prop√≥sito |
|------------|----------------|-----------|
| Workflow | AI Foundry Workflows | Orquestaci√≥n de agentes |
| Agentes | AI Foundry Agents (GPT-4.1) | Procesamiento de lenguaje natural |
| Knowledge Base | Azure AI Search + AI Foundry KB | RAG - B√∫squeda sem√°ntica |
| Almacenamiento | Azure Blob Storage | Datos fuente (JSON) |
| Modelos | Azure OpenAI | GPT-4 / GPT-4.1 |

---

## Paso 1: Preparaci√≥n del Entorno Azure

### 1.1 Login en Azure

```powershell
# Login en Azure
az login

# Verificar suscripci√≥n
az account show

# Cambiar suscripci√≥n si es necesario
az account set --subscription "NOMBRE_O_ID_DE_TU_SUSCRIPCION"
```

### 1.2 Crear Resource Group

```powershell
# Definir variables
$RESOURCE_GROUP = "rg-capibaras-workshop"
$LOCATION = "eastus2"  # O la regi√≥n que prefieras con OpenAI disponible

# Crear resource group
az group create --name $RESOURCE_GROUP --location $LOCATION
```

### 1.3 Verificar Acceso a Azure OpenAI

```powershell
# Verificar providers registrados
az provider show --namespace Microsoft.CognitiveServices --query "registrationState"

# Si no est√° registrado:
az provider register --namespace Microsoft.CognitiveServices
```

> **Nota**: Si no tienes acceso a Azure OpenAI, solic√≠talo en: https://aka.ms/oai/access

---

## Paso 2: Configuraci√≥n de Almacenamiento y Datos

### 2.1 Crear Storage Account

```powershell
$STORAGE_ACCOUNT = "stcapibaras$(Get-Random -Maximum 9999)"
$CONTAINER_NAME = "tribu"

# Crear storage account
az storage account create `
  --name $STORAGE_ACCOUNT `
  --resource-group $RESOURCE_GROUP `
  --location $LOCATION `
  --sku Standard_LRS `
  --kind StorageV2
```

### 2.2 Crear Container para JSON

```powershell
# Obtener connection string
$CONNECTION_STRING = $(az storage account show-connection-string `
  --name $STORAGE_ACCOUNT `
  --resource-group $RESOURCE_GROUP `
  --query connectionString -o tsv)

# Crear container
az storage container create `
  --name $CONTAINER_NAME `
  --connection-string $CONNECTION_STRING `
  --public-access off
```

### 2.3 Subir Archivos JSON

```powershell
# Desde la ra√≠z del proyecto
az storage blob upload-batch `
  --destination $CONTAINER_NAME `
  --source "Capibaras_data/tribu" `
  --connection-string $CONNECTION_STRING `
  --pattern "*.json"

# Verificar subida
az storage blob list `
  --container-name $CONTAINER_NAME `
  --connection-string $CONNECTION_STRING `
  --query "[].name" -o table
```

**Resultado esperado**: ~110 archivos `capibara_001.json` a `capibara_110.json`

### 2.4 Verificar Estructura de Datos

Un archivo JSON t√≠pico tiene esta estructura:

```json
{
  "id": "5577ee85-1a4e-4146-bfca-77c36d870518",
  "capibaraid": "5577ee85-1a4e-4146-bfca-77c36d870518",
  "nombre": "Iker de los Cedros del Estanque",
  "habilidades": [
    {
      "nombre": "Recolecci√≥n de alimentos",
      "nivel": 3
    },
    {
      "nombre": "Trabajo en equipo",
      "nivel": 3
    }
  ],
  "disponibilidad": false
}
```

---

## Paso 3: Creaci√≥n de Azure AI Search y Knowledge Base

### 3.1 Crear Azure AI Search Service

```powershell
$SEARCH_SERVICE = "search-capibaras-$(Get-Random -Maximum 9999)"

# Crear servicio (Free tier)
az search service create `
  --name $SEARCH_SERVICE `
  --resource-group $RESOURCE_GROUP `
  --location $LOCATION `
  --sku free

# O Basic tier para producci√≥n:
# --sku basic
```

### 3.2 Obtener API Keys

```powershell
# Obtener admin key
$SEARCH_KEY = $(az search admin-key show `
  --resource-group $RESOURCE_GROUP `
  --service-name $SEARCH_SERVICE `
  --query primaryKey -o tsv)

# Guardar para despu√©s
Write-Host "Search Service: $SEARCH_SERVICE"
Write-Host "Search Key: $SEARCH_KEY"
```

### 3.3 Crear √çndice en AI Search

**Opci√≥n A: Via Portal Azure**

1. Navegar a Azure Portal ‚Üí Buscar "Azure AI Search"
2. Seleccionar tu servicio `$SEARCH_SERVICE`
3. Click en **"Import data"**
4. **Data Source:**
   - Select data source: Azure Blob Storage
   - Data source name: `capibaras-datasource`
   - Connection string: (de tu storage account)
   - Container name: `tribu`
   - Parsing mode: `JSON`

5. **Add cognitive skills (Optional):**
   - Skip for now (usaremos embeddings de OpenAI despu√©s)

6. **Customize target index:**
   - Index name: `capibaras-index`
   - Key: `id` (String)
   - Configurar campos:
     ```
     nombre: String, Searchable, Retrievable
     habilidades: Collection(Complex), Retrievable
     disponibilidad: Boolean, Filterable, Retrievable
     ```

7. **Create indexer:**
   - Name: `capibaras-indexer`
   - Schedule: Once
   - Click **Submit**

8. Esperar a que el indexer complete (~2-5 minutos)

**Opci√≥n B: Via REST API (Avanzado)**

Ver ejemplo en [Anexo A](#anexo-a-crear-√≠ndice-via-api)

### 3.4 Verificar √çndice

```powershell
# Contar documentos
az search index show `
  --name capibaras-index `
  --service-name $SEARCH_SERVICE `
  --resource-group $RESOURCE_GROUP `
  --query "fields[].name"
```

---

## Paso 4: Creaci√≥n del Proyecto AI Foundry

### 4.1 Acceder a Azure AI Foundry

1. Navegar a: https://ai.azure.com
2. Sign in con tu cuenta de Azure
3. Seleccionar tu suscripci√≥n

### 4.2 Crear un Hub AI

1. Click en **"+ New Hub"** (o **"Create hub"**)
2. Configurar:
   - **Hub name**: `hub-capibaras-workshop`
   - **Subscription**: Tu suscripci√≥n
   - **Resource group**: `rg-capibaras-workshop`
   - **Location**: `East US 2` (o donde creaste los recursos)
   - **Azure OpenAI**: Create new o seleccionar existente
   - **Azure AI Search**: Seleccionar `$SEARCH_SERVICE` (el creado en Paso 3)
   - **Storage account**: Seleccionar `$STORAGE_ACCOUNT`

3. Click **"Next"** ‚Üí **"Create"**

**Tiempo estimado**: 3-5 minutos

### 4.3 Crear un Proyecto

1. Una vez creado el Hub, click **"+ New Project"**
2. Configurar:
   - **Project name**: `capibara-council`
   - **Hub**: Seleccionar `hub-capibaras-workshop`

3. Click **"Create"**

### 4.4 Verificar Conexiones

1. En el proyecto, ir a **Settings** ‚Üí **Connected resources**
2. Verificar que aparezcan:
   - ‚úÖ Azure OpenAI
   - ‚úÖ Azure AI Search
   - ‚úÖ Storage Account

---

## Paso 5: Configuraci√≥n de Modelos

### 5.1 Desplegar Modelo GPT-4

1. En AI Foundry, ir a **Models + Endpoints** (men√∫ izquierdo)
2. Click **"+ Deploy model"** ‚Üí **"Deploy base model"**
3. Buscar **"gpt-4"** o **"gpt-4-turbo"**
4. Click **"Confirm"**
5. Configurar deployment:
   - **Deployment name**: `gpt-4.1` (¬°importante! as√≠ est√° en los YAML)
   - **Model version**: Latest
   - **Deployment type**: Standard
   - **Tokens per minute rate limit**: 10K (o seg√∫n tu quota)

6. Click **"Deploy"**

**Tiempo estimado**: 2-3 minutos

### 5.2 Verificar Deployment

1. En **Models + Endpoints**, verificar que `gpt-4.1` aparezca con estado **"Succeeded"**
2. Anotar el **Deployment name** exacto (debe ser `gpt-4.1`)

> **Importante**: Los archivos YAML de agentes usan `model: gpt-4.1`. Si usaste otro nombre, deber√°s ajustar todos los YAML.

### 5.3 (Opcional) Deployment de Embeddings

Para b√∫squeda vectorial avanzada:

```powershell
# Deployment name: text-embedding-ada-002
# Model: text-embedding-ada-002
```

---

## Paso 6: Creaci√≥n de Knowledge Base en AI Foundry

### 6.1 Crear Knowledge Base

1. En AI Foundry, ir a **Knowledge** (men√∫ izquierdo)
2. Click **"+ New Knowledge base"**
3. Configurar:
   - **Name**: `knowledgebase803` (o el nombre que aparece en tus YAML)
   - **Description**: "Base de conocimientos de capibaras con habilidades"
   - **Search service**: Seleccionar `$SEARCH_SERVICE`

4. Click **"Create"**

### 6.2 Conectar al √çndice de AI Search

1. En la Knowledge Base creada, click **"+ Add data source"**
2. Seleccionar **"Azure AI Search"**
3. Configurar:
   - **Connection**: Seleccionar tu AI Search service
   - **Index**: Seleccionar `capibaras-index`
   - **Embedding model**: (Opcional) Seleccionar si desplegaste text-embedding-ada-002

4. Click **"Add"**

### 6.3 Obtener URL de Knowledge Base (MCP Server)

1. En la Knowledge Base, click en **"Settings"** o **"Connect"**
2. Buscar **"MCP Server URL"** o **"Endpoint"**
3. Copiar la URL, deber√≠a tener este formato:
   ```
   https://<search-service>.search.windows.net/knowledgebases/<kb-name>/mcp?api-version=2025-11-01-Preview
   ```

4. **Guardar esta URL**, la necesitaremos para los agentes

**Ejemplo real de los YAML:**
```
https://capibaras.search.windows.net/knowledgebases/knowledgebase803/mcp?api-version=2025-11-01-Preview
```

### 6.4 Probar Knowledge Base

1. En la Knowledge Base, ir a **"Test"** o **"Playground"**
2. Hacer una consulta de prueba:
   ```
   Encuentra capibaras con habilidad "Cocina al fuego" nivel 4 o superior
   ```
3. Verificar que devuelva resultados del √≠ndice

---

## Paso 7: Creaci√≥n de Agentes

Crearemos 5 agentes en total: 1 orquestador + 4 especialistas.

### 7.1 Agente 1: Secretario (Orquestador)

1. En AI Foundry, ir a **Agents** (men√∫ izquierdo)
2. Click **"+ New Agent"**
3. Configurar:

**General:**
- **Name**: `CapibaraSecretario`
- **Description**: "Agente orquestador que deriva tareas a directores"

**Model Configuration:**
- **Model**: `gpt-4.1` (seleccionar el deployment creado)
- **Temperature**: `0.7`
- **Top P**: `0.01`

**Instructions (System Prompt):**
```
Eres Valent√≠n Ordena, Capibara Secretario y agente orquestador de la tribu. Eres organizado, preciso y con una gran capacidad para entender las necesidades del Capibara Jefe y traducirlas en instrucciones claras para los directores de √°rea. Tu fortaleza es tu visi√≥n global: sabes interpretar el contexto y elegir al director m√°s adecuado para cada tarea, asegurando que la comunicaci√≥n sea coherente y sin ambig√ºedades. Tu debilidad es que tu af√°n por estructurar la informaci√≥n puede hacer que, en casos urgentes, tardes m√°s de lo deseable en delegar. Tu estilo de liderazgo es facilitador: no ejecutas las tareas por ti mismo, pero tu trabajo hace posible que todos los directores y sus equipos operen de forma ordenada, eficaz y enfocada.

Tu misi√≥n es recibir las solicitudes del Capibara Jefe y analizar el contenido para decidir qu√© Capibara Director de √°rea debe llevar la tarea. Nunca realizas t√∫ mismo la tarea final, sino que reformulas la instrucci√≥n y la env√≠as √≠ntegra al director m√°s adecuado seg√∫n los criterios de especialidad. No inventes informaci√≥n sobre los miembros de la tribu. No alteres los roles definidos. El resultado esperado es un mensaje limpio y claro orientado al director elegido.

A√±ade al final uno de los siguientes c√≥digos:
[INTENDENCIA],[SEGURIDAD],[INFRASTRUCTURAS],[FESTEJOS]

Si no tienes clara la acci√≥n, solicitale m√°s informaci√≥n al jefe.
```

**Tools/Functions:**
- No agregar ninguna tool (este agente no consulta KB, solo deriva)

**Advanced Settings:**
- **Response format**: Text
- **Tool choice**: Auto

4. Click **"Create"** o **"Save"**

### 7.2 Agente 2: Intendencia

1. Click **"+ New Agent"**
2. Configurar:

**General:**
- **Name**: `Intendencia`
- **Description**: "Director de Intendencia - Alimentaci√≥n y cocina"

**Model:**
- **Model**: `gpt-4.1`
- **Temperature**: `0.01`
- **Top P**: `0.01`

**Instructions:**
```
Eres Mateo Sabores, Capibara Director de Intendencia. Eres meticuloso y creativo, con una pasi√≥n genuina por encontrar nuevas combinaciones de ingredientes y cuidar que cada comida sea nutritiva, equilibrada y deliciosa. Tu fortaleza est√° en tu atenci√≥n al detalle y tu capacidad para planificar men√∫s √≥ptimos. Tu debilidad es que a veces puedes dedicar demasiado tiempo a perfeccionar un plato, retrasando la ejecuci√≥n. Tu estilo de liderazgo es colaborativo: escuchas ideas de tu equipo y valoras el trabajo conjunto, pero siempre mantienes un est√°ndar alto de calidad.

Recibes tareas relacionadas con Men√∫s, alimentaci√≥n y cocina. Consultas la base de datos de capibaras para seleccionar el n√∫mero necesario de trabajadores y sus roles seg√∫n sus habilidades. Elaboras un plan de trabajo detallado para:
1. Recolecci√≥n y adquisici√≥n de alimentos.
2. Elaboraci√≥n del men√∫.
3. Proceso de cocina.

Cada plan debe asignar siempre responsables y describir pasos claros y secuenciales.

Usa la knowledge base para designar a los capibaras m√°s aptos para cada tarea.

Las habilidades de los miembros de la tribu son:
| # | Habilidad | Nivel (1-5) | √Åmbito principal |
|---|---------------------------------|-------------|------------------|
| 1 | Recolecci√≥n de alimentos | 1-5 | Intendencia |
| 2 | Preparaci√≥n de recetas | 1-5 | Intendencia |
| 3 | Cocina al fuego | 1-5 | Intendencia |
| 4 | Conservaci√≥n de alimentos | 1-5 | Intendencia |
| 5 | Vigilancia | 1-5 | Seguridad |
| 6 | Rastreo y exploraci√≥n | 1-5 | Seguridad |
| 7 | Evaluaci√≥n de recursos naturales | 1-5 | Seguridad |
| 8 | Ingenier√≠a de estructuras | 1-5 | Infraestructuras |
| 9 | Carpinter√≠a | 1-5 | Infraestructuras |
|10 | Alba√±iler√≠a | 1-5 | Infraestructuras |
|11 | Decoraci√≥n y ambientaci√≥n | 1-5 | Festejos |
|12 | Organizaci√≥n de eventos | 1-5 | Festejos |
|13 | M√∫sica y animaci√≥n | 1-5 | Festejos |
|14 | Trabajo en equipo | 1-5 | Todas |
|15 | Gesti√≥n de recursos | 1-5 | Todas |

El esquema de la definici√≥n de un capibara es:
{
  "id": "UUID",  
  "nombre": "string",
  "habilidades": [
    {
      "nombre": "string",
      "nivel": "integer (1-5)"
    }
  ],
  "rol_actual": "string (opcional)",
  "disponibilidad": "boolean"
}
```

**Tools:**
1. Click **"+ Add tool"** ‚Üí **"MCP Server"**
2. Configurar:
   - **Server label**: `kb_knowledgebase803_bg1ez` (o el nombre de tu KB)
   - **Server URL**: (la URL MCP obtenida en Paso 6.3)
   - **Require approval**: Never
   - **Project connection**: Seleccionar tu Knowledge Base

3. Click **"Add"**

4. Click **"Create"/"Save"**

### 7.3 Agente 3: Seguridad

Repetir proceso del 7.2 con estos datos:

**Name**: `Seguridad`

**Instructions:**
```
Eres Luc√≠a Centinela, Capibara Director de Seguridad. Eres observadora, prudente y de car√°cter firme. Te encanta recorrer el territorio, anticipar los riesgos y mantener a todos a salvo. Tu fortaleza es tu capacidad de an√°lisis y tu compromiso inquebrantable con la seguridad de la tribu. Tu debilidad es que tu cautela puede hacerte rechazar opciones de avance que podr√≠an ser seguras si se evaluaran m√°s r√°pido. Tu estilo de liderazgo es estrat√©gico: estableces protocolos claros y fomentas disciplina, pero tambi√©n apoyas la iniciativa individual en situaciones de emergencia.

Recibes tareas relacionadas con vigilancia, exploraci√≥n de nuevas ubicaciones y verificaci√≥n de seguridad y recursos. Consultas la base de datos de capibaras para seleccionar el n√∫mero necesario de trabajadores y roles seg√∫n habilidades. Elaboras un plan para:
1. Organizaci√≥n de turnos de vigilancia.
2. Exploraci√≥n y an√°lisis de nuevas ubicaciones.
3. Verificaci√≥n de recursos y condiciones para el traslado.

Indica siempre nombre de responsables y horarios, adem√°s de criterios de seguridad.

Usa la knowledge base para designar a los capibaras m√°s aptos para cada tarea.

[Incluir tabla de habilidades y esquema JSON igual que Intendencia]
```

**Tools**: Mismo MCP Server de Knowledge Base

**Model**: `gpt-4.1`, Temperature: `0.01`, Top P: `0.01`

### 7.4 Agente 4: Infraestructuras

**Name**: `Infraestructuras`

**Instructions:**
```
Eres H√©ctor Construye, Capibara Director de Infraestructuras. Eres resolutivo y visionario, con pasi√≥n por dise√±ar y mejorar continuamente el poblado. Tu fortaleza es tu pensamiento estructurado y tu habilidad para convertir ideas en planes tangibles. Tu debilidad es que en ocasiones puedes sobrecargar a tu equipo con proyectos simult√°neos, dificultando la finalizaci√≥n en tiempo. Tu estilo de liderazgo es planificador: asignas tareas espec√≠ficas a cada miembro, estableces plazos firmes y promueves la optimizaci√≥n de recursos.

Recibes tareas relacionadas con mantenimiento o construcci√≥n de estructuras. Consultas la base de datos para seleccionar trabajadores con las habilidades necesarias. Elaboras un plan para:
1. Reparaci√≥n de infraestructuras existentes.
2. Dise√±o y construcci√≥n de nuevas estructuras.
3. Distribuci√≥n de recursos.

Siempre indica responsables por tarea y secuencia de ejecuci√≥n.

Usa la knowledge base para designar a los capibaras m√°s aptos para cada tarea.

[Incluir tabla de habilidades y esquema JSON]
```

**Tools**: MCP Server KB

**Model**: `gpt-4.1`, Temperature: `0.01`, Top P: `0.01`

### 7.5 Agente 5: Festejos

**Name**: `Festejos`

**Instructions:**
```
Eres Sof√≠a Alegr√≠a, Capibara Director de Festejos. Eres carism√°tica y entusiasta, con un talento natural para motivar a la comunidad y lograr que cada celebraci√≥n sea inolvidable. Tu fortaleza es tu energ√≠a positiva y tu habilidad para coordinar muchos elementos a la vez, desde la decoraci√≥n hasta las actividades. Tu debilidad es que puedes dispersarte si intentas abarcar demasiadas ideas simult√°neamente. Tu estilo de liderazgo es motivador: inspiras a tu equipo, fomentas la creatividad y priorizas que cada evento fortalezca el v√≠nculo entre todos los capibaras.

Recibes tareas relacionadas con celebraciones de todo tipo. Consultas la base de datos para seleccionar capibaras con habilidades relevantes. Elaboras un plan para:
1. Preparativos y decoraci√≥n.
2. Organizaci√≥n de actividades y ceremonias.
3. Supervisi√≥n del evento.

Usa la knowledge base para designar a los capibaras m√°s aptos para cada tarea.
Siempre indica responsables de las tareas y tiempos para cada etapa.

[Incluir tabla de habilidades y esquema JSON]
```

**Tools**: MCP Server KB

**Model**: `gpt-4.1`, Temperature: `0.7`, Top P: `0.01`

### 7.6 Verificar Agentes Creados

1. Ir a **Agents** en el men√∫ lateral
2. Deber√≠as ver los 5 agentes:
   - ‚úÖ CapibaraSecretario
   - ‚úÖ Intendencia
   - ‚úÖ Seguridad
   - ‚úÖ Infraestructuras
   - ‚úÖ Festejos

---

## Paso 8: Creaci√≥n del Workflow Orquestador

### 8.1 Crear Nuevo Workflow

1. En AI Foundry, ir a **Workflows** (men√∫ izquierdo)
2. Click **"+ New Workflow"**
3. Configurar:
   - **Name**: `Capibaras` o `CapibaraCouncil`
   - **Description**: "Workflow orquestador de consejo de capibaras"

4. Click **"Create"**

### 8.2 Configurar el Canvas

Se abrir√° el **Workflow Designer** (interfaz visual de arrastrar y soltar).

### 8.3 Agregar Trigger

Por defecto, deber√≠a haber un **Trigger** configurado como `OnConversationStart`. Si no:

1. Click en √°rea de canvas
2. En panel derecho, seleccionar:
   - **Trigger type**: `OnConversationStart`
   - **ID**: `trigger_wf`

### 8.4 Agregar Nodo: Invoke Secretario

1. Desde la barra de herramientas, arrastrar **"Invoke Agent"** al canvas
2. Conectar desde **Trigger** ‚Üí **Invoke Agent**
3. Configurar el nodo:
   - **ID**: `node-1771618562421` (o dejar auto-generado)
   - **Agent**: Seleccionar `CapibaraSecretario`
   - **Conversation ID**: `=System.ConversationId`
   - **Input messages**: `""` (vac√≠o, toma de conversaci√≥n)
   - **Output**: 
     - Variable: `Local.secretarioMessage`
     - Auto-send: ‚úÖ Checked

4. **External Loop** (bucle hasta que secretario derive):
   ```
   =IsBlank(Find("[INTENDENCIA]",Last(Local.secretarioMessage).Text))
   And
   IsBlank(Find("[SEGURIDAD]",Last(Local.secretarioMessage).Text))
   And
   IsBlank(Find("[INFRASTRUCTURAS]",Last(Local.secretarioMessage).Text))
   And
   IsBlank(Find("[FESTEJOS]",Last(Local.secretarioMessage).Text))
   ```

   Esto hace que el secretario siga preguntando hasta incluir un tag.

### 8.5 Agregar Nodo: Condition Group

1. Arrastrar **"Condition Group"** al canvas
2. Conectar desde **Invoke Secretario** ‚Üí **Condition Group**
3. Configurar 4 condiciones:

**Condici√≥n 1: INTENDENCIA**
- **Condition**: `=!IsBlank(Find("[INTENDENCIA]", Upper(Last(Local.secretarioMessage).Text)))`
- **Action**: Invoke Agent
  - **Agent**: `Intendencia`
  - **Conversation ID**: `=System.ConversationId`
  - **Output**: Auto-send

**Condici√≥n 2: SEGURIDAD**
- **Condition**: `=!IsBlank(Find("[SEGURIDAD]", Upper(Last(Local.secretarioMessage).Text)))`
- **Action**: Invoke Agent
  - **Agent**: `Seguridad`
  - **Conversation ID**: `=System.ConversationId`
  - **Output**: Auto-send

**Condici√≥n 3: FESTEJOS**
- **Condition**: `=!IsBlank(Find("[FESTEJOS]", Upper(Last(Local.secretarioMessage).Text)))`
- **Action**: Invoke Agent
  - **Agent**: `Festejos`
  - **Conversation ID**: `=System.ConversationId`
  - **Output**: Auto-send

**Condici√≥n 4: INFRASTRUCTURAS**
- **Condition**: `=!IsBlank(Find("[INFRASTRUCTURAS]", Upper(Last(Local.secretarioMessage).Text)))`
- **Action**: Invoke Agent
  - **Agent**: `Infraestructuras`
  - **Conversation ID**: `=System.ConversationId`
  - **Output**: Auto-send

### 8.6 Agregar Nodo: End Conversation

1. Arrastrar **"End Conversation"** al canvas
2. Conectar desde **Condition Group** ‚Üí **End Conversation**
3. ID: `node-1771618590980` (o auto-generado)

### 8.7 Diagrama Final

El flujo deber√≠a verse as√≠:

```
[Trigger: OnConversationStart]
         ‚Üì
[Invoke: CapibaraSecretario] (loop externo)
         ‚Üì
[Condition Group]
    ‚îú‚îÄ [INTENDENCIA]? ‚Üí [Invoke: Intendencia]
    ‚îú‚îÄ [SEGURIDAD]? ‚Üí [Invoke: Seguridad]
    ‚îú‚îÄ [FESTEJOS]? ‚Üí [Invoke: Festejos]
    ‚îî‚îÄ [INFRASTRUCTURAS]? ‚Üí [Invoke: Infraestructuras]
         ‚Üì
[End Conversation]
```

### 8.8 Guardar Workflow

1. Click **"Save"** en la esquina superior derecha
2. Verificar que no haya errores de validaci√≥n

---

## Paso 9: Testing y Validaci√≥n

### 9.1 Test desde AI Foundry Playground

1. En el Workflow, click **"Test"** o **"Chat"**
2. Se abrir√° el **Playground**
3. Iniciar conversaci√≥n:

**Test 1: Festejos**
```
Usuario: Necesito organizar una fiesta para celebrar la cosecha
```

**Resultado esperado:**
- Secretario responde con an√°lisis + `[FESTEJOS]`
- Se invoca agente Festejos
- Festejos consulta KB y asigna capibaras con habilidades:
  - Decoraci√≥n y ambientaci√≥n
  - Organizaci√≥n de eventos
  - M√∫sica y animaci√≥n

**Test 2: Intendencia**
```
Usuario: Prepara un men√∫ para 50 capibaras con ingredientes de temporada
```

**Resultado esperado:**
- Secretario ‚Üí `[INTENDENCIA]`
- Intendencia consulta KB y asigna:
  - Recolecci√≥n de alimentos
  - Preparaci√≥n de recetas
  - Cocina al fuego

**Test 3: Seguridad**
```
Usuario: Necesito explorar el valle norte para posible nuevo asentamiento
```

**Resultado esperado:**
- Secretario ‚Üí `[SEGURIDAD]`
- Seguridad asigna:
  - Rastreo y exploraci√≥n
  - Evaluaci√≥n de recursos naturales
  - Vigilancia

**Test 4: Infraestructuras**
```
Usuario: El puente del arroyo necesita reparaci√≥n urgente
```

**Resultado esperado:**
- Secretario ‚Üí `[INFRASTRUCTURAS]`
- Infraestructuras asigna:
  - Ingenier√≠a de estructuras
  - Carpinter√≠a
  - Alba√±iler√≠a

### 9.2 Verificar Consultas a Knowledge Base

En cada respuesta de los directores, verificar que:
1. Se consulte la KB (deber√≠a mencionar nombres espec√≠ficos de capibaras)
2. Se listen habilidades con niveles
3. Se indiquen responsables
4. Se incluya timeline/secuencia

### 9.3 Debugging

Si algo falla:

1. **El secretario no deriva**:
   - Verificar que el prompt del secretario incluya instrucciones de tags
   - Revisar que el external loop est√© configurado

2. **Los directores no consultan KB**:
   - Verificar que tengan el MCP Server tool conectado
   - Revisar que la KB tenga datos indexados

3. **Errores de modelo**:
   - Verificar que el deployment `gpt-4.1` exista
   - Revisar quotas de tokens

---

## Paso 10: Despliegue y Consumo

### 10.1 Publicar el Workflow

1. En el Workflow, click **"Deploy"** o **"Publish"**
2. Configurar:
   - **Deployment name**: `capibara-council-v1`
   - **Environment**: Production (o Development)

3. Click **"Deploy"**

**Tiempo estimado**: 2-3 minutos

### 10.2 Obtener Endpoint

1. Una vez desplegado, ir a **Deployments**
2. Seleccionar `capibara-council-v1`
3. Copiar:
   - **Endpoint URL**
   - **Primary Key** (authentication)

### 10.3 Consumo desde Python (Opcional)

El c√≥digo de ejemplo ya existe en `code/capibaras.py`. Configurar:

```powershell
# Crear .env
echo "AZURE_AI_PROJECT_ENDPOINT=<tu-endpoint>" > .env

# Activar entorno
.\.venv\Scripts\Activate.ps1

# Ejecutar
cd code
python .\capibaras.py
```

**Output esperado:**
```
Capibara Jefe > Organiza una fiesta
Secretario: Analizando solicitud... [FESTEJOS]
Festejos: ¬°Perfecto! He asignado a:
  - Sof√≠a con decoraci√≥n (nivel 5)
  - Mario con m√∫sica (nivel 4)
  ...
```

### 10.4 Consumo desde Web App (Flask)

El c√≥digo `web_app.py` proporciona una interfaz web:

```powershell
cd code
python .\web_app.py
```

Navegar a: http://localhost:5000

### 10.5 Integraci√≥n con Teams/Slack (Avanzado)

Azure AI Foundry soporta conectores a:
- Microsoft Teams
- Slack
- Custom webhooks

Ver documentaci√≥n: https://learn.microsoft.com/azure/ai-foundry/

---

## Paso 11: Monitoreo y Observabilidad

### 11.1 Ver Logs de Conversaciones

1. En AI Foundry, ir a **Monitoring** o **Tracing**
2. Seleccionar el deployment
3. Ver:
   - Conversaciones recientes
   - Latencia
   - Tokens consumidos
   - Errores

### 11.2 Application Insights (Opcional)

Para monitoring avanzado:

```powershell
# Crear App Insights
az monitor app-insights component create `
  --app capibaras-insights `
  --resource-group $RESOURCE_GROUP `
  --location $LOCATION

# Obtener instrumentation key
$INSTRUMENTATION_KEY = $(az monitor app-insights component show `
  --app capibaras-insights `
  --resource-group $RESOURCE_GROUP `
  --query instrumentationKey -o tsv)
```

Configurar en AI Foundry Settings ‚Üí Monitoring ‚Üí Application Insights

---

## Troubleshooting

### Problema: El √≠ndice de AI Search est√° vac√≠o

**Soluci√≥n:**
```powershell
# Forzar ejecuci√≥n del indexer
az search indexer run `
  --name capibaras-indexer `
  --service-name $SEARCH_SERVICE `
  --resource-group $RESOURCE_GROUP

# Esperar 2-3 minutos y verificar
az search indexer status `
  --name capibaras-indexer `
  --service-name $SEARCH_SERVICE `
  --resource-group $RESOURCE_GROUP
```

### Problema: Error "Model deployment not found"

**Soluci√≥n:**
- Verificar que el nombre del deployment sea exactamente `gpt-4.1`
- En AI Foundry ‚Üí Models + Endpoints, confirmar que est√° "Succeeded"
- Si usaste otro nombre, actualizar TODOS los agentes

### Problema: Knowledge Base no devuelve resultados

**Soluci√≥n:**
1. Verificar que el √≠ndice tenga documentos:
   ```powershell
   az search index statistics show `
     --name capibaras-index `
     --service-name $SEARCH_SERVICE `
     --resource-group $RESOURCE_GROUP
   ```

2. Probar query directa en AI Search:
   - Portal Azure ‚Üí AI Search ‚Üí Search Explorer
   - Query: `*` (devuelve todos)

3. Verificar estructura de habilidades en JSON

### Problema: El secretario no encuentra el tag

**Soluci√≥n:**
- Verificar que el external loop est√© configurado en el Invoke Node
- Probar en Playground con prompt expl√≠cito: "Deriva a Festejos"
- Revisar que el system prompt del secretario mencione los 4 tags

### Problema: Quota de tokens excedida

**Soluci√≥n:**
```powershell
# Ver quota actual
az cognitiveservices account show `
  --name <tu-openai-resource> `
  --resource-group $RESOURCE_GROUP `
  --query properties.quotas

# Solicitar aumento en Portal Azure ‚Üí OpenAI ‚Üí Quotas
```

---

## Recursos Adicionales

### Documentaci√≥n Oficial

- **Azure AI Foundry**: https://learn.microsoft.com/azure/ai-foundry/
- **Azure OpenAI Service**: https://learn.microsoft.com/azure/ai-services/openai/
- **Azure AI Search**: https://learn.microsoft.com/azure/search/
- **Prompt Flow**: https://learn.microsoft.com/azure/ai-foundry/how-to/flow-develop

### Ejemplos de C√≥digo

- GitHub - Azure AI Samples: https://github.com/Azure-Samples/ai-samples
- Foundry SDK (Python): https://learn.microsoft.com/python/api/overview/azure/ai-projects

### Comunidad

- Microsoft Tech Community - AI: https://techcommunity.microsoft.com/t5/ai/ct-p/AI
- Stack Overflow Tag: `azure-ai-foundry`

---

## Anexos

### Anexo A: Crear √çndice via API

```powershell
$INDEX_SCHEMA = @"
{
  "name": "capibaras-index",
  "fields": [
    {
      "name": "id",
      "type": "Edm.String",
      "key": true,
      "searchable": false,
      "filterable": true,
      "sortable": true
    },
    {
      "name": "nombre",
      "type": "Edm.String",
      "searchable": true,
      "filterable": false,
      "sortable": true
    },
    {
      "name": "habilidades",
      "type": "Collection(Edm.ComplexType)",
      "fields": [
        {
          "name": "nombre",
          "type": "Edm.String",
          "searchable": true,
          "filterable": true
        },
        {
          "name": "nivel",
          "type": "Edm.Int32",
          "filterable": true,
          "sortable": true
        }
      ]
    },
    {
      "name": "disponibilidad",
      "type": "Edm.Boolean",
      "filterable": true
    }
  ]
}
"@

# Crear √≠ndice
Invoke-RestMethod -Method Put `
  -Uri "https://$SEARCH_SERVICE.search.windows.net/indexes/capibaras-index?api-version=2021-04-30-Preview" `
  -Headers @{
    "api-key" = $SEARCH_KEY
    "Content-Type" = "application/json"
  } `
  -Body $INDEX_SCHEMA
```

### Anexo B: YAML Completo de Workflow

Ver archivo: [AIFoundry/Workflows/CapibaraCouncil.yaml](AIFoundry/Workflows/CapibaraCouncil.yaml)

### Anexo C: Ejemplos de Queries a Knowledge Base

```python
from azure.search.documents import SearchClient
from azure.core.credentials import AzureKeyCredential

# Query 1: Capibaras con habilidad espec√≠fica
results = search_client.search(
    search_text="Cocina al fuego",
    filter="habilidades/any(h: h/nombre eq 'Cocina al fuego' and h/nivel ge 4)"
)

# Query 2: Disponibles y con m√∫ltiples habilidades
results = search_client.search(
    search_text="",
    filter="disponibilidad eq true and habilidades/any(h: h/nombre eq 'Carpinter√≠a' and h/nivel ge 3)"
)
```

---

## Checklist de Completitud

Antes de terminar el workshop, verificar que:

- [ ] Resource Group creado con todos los servicios
- [ ] Storage Account con ~110 JSON files
- [ ] Azure AI Search con √≠ndice poblado (100+ documentos)
- [ ] AI Foundry Hub creado
- [ ] AI Foundry Project creado
- [ ] Modelo GPT-4 desplegado como `gpt-4.1`
- [ ] Knowledge Base creada y conectada a AI Search
- [ ] 5 Agentes creados (Secretario + 4 Directores)
- [ ] Workflow creado con l√≥gica de derivaci√≥n
- [ ] Tests exitosos en Playground
- [ ] (Opcional) Deployment publicado
- [ ] (Opcional) Aplicaci√≥n local funcionando

---

## Tiempos Estimados

| Paso | Descripci√≥n | Tiempo |
|------|-------------|--------|
| 1 | Setup Azure + Resource Group | 5 min |
| 2 | Storage + Upload JSON | 10 min |
| 3 | AI Search + Indexer | 15 min |
| 4 | AI Foundry Hub + Project | 10 min |
| 5 | Deploy GPT-4 model | 5 min |
| 6 | Knowledge Base setup | 10 min |
| 7 | Crear 5 agentes | 30 min |
| 8 | Workflow orquestador | 20 min |
| 9 | Testing | 15 min |
| 10 | Deployment | 5 min |
| **TOTAL** | | **~2 horas** |

---

## Pr√≥ximos Pasos Sugeridos

1. **Agregar m√°s habilidades**: Expandir a nuevos departamentos (Salud, Educaci√≥n, etc.)
2. **Integrar con Power Platform**: Conectar a Power Apps/Power Automate
3. **Implementar memory**: Usar Azure Cosmos DB para historial de conversaciones
4. **Fine-tuning**: Entrenar modelo personalizado con datos de capibaras
5. **Multimodal**: Agregar generaci√≥n de im√°genes (DALL-E) para visualizar equipos

---

**¬°Felicidades! Has completado el despliegue end-to-end de una soluci√≥n Multi-Agente con NEW AI Foundry.**

Para dudas o feedback: https://www.powerplatformcastellon.es/

---

*√öltima actualizaci√≥n: Febrero 2026*
*Versi√≥n: 1.0*
*Autor: Equipo Power Platform Castell√≥n*
